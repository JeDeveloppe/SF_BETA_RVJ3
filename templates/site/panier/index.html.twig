{% extends 'site/base.html.twig' %}

{% block title %}Panier{% endblock %}


{% block body %}

    <h1 class="col-12 text-center my-5">Panier</h1>

    <div class="row justify-content-start">

        {% if panier_occasions | length > 0 %}
            <div class="col-11 mx-auto mb-5">
                <table class="table table-striped table-dark text-center">
                    <thead>
                        <th>Occasion</th>
                        <th>Nom / Editeur / Année</th>
                        <th>États</th>
                        <th>Prix TTC</th>
                        <th></th>
                    </thead>
                    <tbody>

                        {% for key,panier_occasion in panier_occasions %}
                            <tr>
                                <td></td>
                                <td>
                                    {{ panier_occasion.occasion.boite.nom }} <br/>
                                    {{ panier_occasion.occasion.boite.editeur }} <br />
                                    {{ panier_occasion.occasion.boite.annee }}
                                </td>
                                <td>
                                    État de la boite: {{ panier_occasion.occasion.etatBoite }} <br/>
                                    État du matériel: {{ panier_occasion.occasion.etatMateriel }} <br/>
                                    Règle du jeu: {{ panier_occasion.occasion.regleJeu }}
                                </td>
                                <td class="align-middle">{{ (panier_occasion.occasion.priceHt * tva) | number_format(2, '.', ',') }}</td>
                                <td class="align-middle"><a class="btn btn-danger" href="{{ path('app_panier_delete', {'id': panier_occasion.id}) }}">Sup</a></td>
                            </tr>
                        {% endfor %}

                    </tbody>
                </table>
            </div>
        {% endif %}

        {% if panier_boites | length > 0 %}
            <div class="col-11 mx-auto mb-5">
                <table class="table table-striped table-dark text-center">
                    <thead>
                        <th>Boite</th>
                        <th>Nom / Editeur / Année</th>
                        <th>Votre message</th>
                        <th></th>
                    </thead>
                    <tbody>

                        {% for key,panier_boite in panier_boites %}
                            <tr>
                                <td></td>
                                <td>
                                    {{ panier_boite.boite.nom }} <br/>
                                    {{ panier_boite.boite.editeur }} <br />
                                    {{ panier_boite.boite.annee }}
                                </td>
                                <td class="align-middle">{{ panier_boite.message }}</td>
                                <td class="align-middle"><a class="btn btn-danger" href="{{ path('app_panier_delete', {'id': panier_boite.id}) }}">Sup</a></td>
                            </tr>
                        {% endfor %}

                    </tbody>
                </table>
            </div>
        {% endif %}
    </div>

    {% if panier_boites | length > 0 %}
        {% set formAction = path('panier-mise-en-devis') %}
    {% else %}
        {% set formAction = "PAYER" %}
    {% endif %}

    <form class="row justify-content-around mb-5" method="post" action="{{ formAction }}">
        <div class="col-5 d-flex flex-wrap border border-primary bg-secondary py-2">
            <h3 class="col-12 text-center">Facturation:</h3>
            {% if facturation_adresses | length > 0 %}
                {% for adresse in facturation_adresses %}
                    <div class="form-check col-6">
                        <input class="form-check-input" type="radio" name="adresseFacturation" id="adresseFacturation" required 
                        value="{{ adresse.lastName }} {{ adresse.firstName }}<br/>
                            {{ adresse.adresse }}<br/>
                            {{ adresse.ville.villeCodePostal }} {{ adresse.ville.villeNom }}">
                        <label class="form-check-label" for="adresseFacturation">
                            {{ adresse.lastName }} {{ adresse.firstName }}<br/>
                            {{ adresse.adresse }}<br/>
                            {{ adresse.ville.villeCodePostal }} {{ adresse.ville.villeNom }}
                        </label>
                    </div>
                {% endfor %}
                {% if facturation_adresses | length < 2 %}
                    <div class="col-12 text-center">
                        <a class="btn btn-primary" href="{{ path('app_adresse_new', {'slug': 'facturation'}) }}">Créer une adresse de facturation...</a>
                    </div>
                {% endif %}
            {% else %}
                <a class="btn btn-primary" href="{{ path('app_adresse_new', {'slug': 'facturation'}) }}">Créer une adresse de facturation...</a>
            {% endif %}
        </div>

        <div class="col-5 d-flex flex-wrap border border-primary bg-secondary py-2">
            {% if panier_occasions | length > 0 %}
                <h3 class="col-12 text-center">Retrait:</h3>
                    <div class="form-check col-6">
                        <input class="form-check-input" type="radio" name="adresseLivraison" id="adresseLivraison" checked required
                        value="COOP 5 POUR 100<br/>
                            33 Rte de Trouville<br/>
                            14 000 CAEN">
                        <label class="form-check-label" for="adresseLivraison">
                            COOP 5 pour 100<br/>
                            33 Rte de Trouville<br/>
                            14 000 CAEN
                        </label>
                    </div>
            {% else %}
                <h3 class="col-12 text-center">Livraison:</h3>
                {% if livraison_adresses | length > 0 %}
                    {% for adresse in livraison_adresses %}
                        <div class="form-check col-6">
                            <input class="form-check-input" type="radio" name="adresseLivraison" id="adresseLivraison" required
                            value="{{ adresse.lastName }} {{ adresse.firstName }}<br/>
                            {{ adresse.adresse }}<br/>
                            {{ adresse.ville.villeCodePostal }} {{ adresse.ville.villeNom }}">
                            <label class="form-check-label" for="adresseLivraison">
                                {{ adresse.lastName }} {{ adresse.firstName }}<br/>
                                {{ adresse.adresse }}<br/>
                                {{ adresse.ville.villeCodePostal }} {{ adresse.ville.villeNom }}
                            </label>
                        </div>
                    {% endfor %}
                    {% if livraison_adresses | length < 2 %}
                        <div class="col-12 text-center">
                            <a class="btn btn-primary" href="{{ path('app_adresse_new', {'slug': 'livraison'}) }}">Créer une adresse de livraison...</a>
                        </div>
                    {% endif %}
                {% else %}
                    <a class="btn btn-primary" href="{{ path('app_adresse_new', {'slug': 'livraison'}) }}">Créer une adresse de livraison...</a>
                {% endif %}
            {% endif %}      
        </div>

        {% if panier_boites | length > 0 %}
            <div class="col-10 mx-auto my-5">
                <input class="col-12" type="submit" value="Demander un devis">
            </div>
        {% else %}
            <div class="col-10 mx-auto my-5">
                <input class="col-12" type="submit" value="Payer">
            </div>
        {% endif %}
    </form>

{% endblock %}
